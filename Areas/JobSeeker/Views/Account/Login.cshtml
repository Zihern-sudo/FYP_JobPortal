@{
    ViewData["Title"] = "Login / Register";
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<div class="auth-container">
    <h1>Welcome to JobPortal</h1>

    <div class="tabs">
        <span id="loginTab" class="active">Login</span>
        <span id="registerTab">Register</span>
    </div>

    <div class="form-wrapper">
        <!-- ✅ Login Form -->
        <form id="loginForm" asp-area="JobSeeker" asp-controller="Account" asp-action="Login" method="post"
            class="auth-form active">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="Enter your email" value="@ViewBag.Email" required>

            <label for="password">Password</label>
            <div class="password-wrapper">
                <input type="password" id="password" name="password" placeholder="Enter password" required
                    maxlength="20" />
                <span class="toggle-password"><i class="bi bi-eye"></i></span>
            </div>

            <div class="forgot-password">
                <a asp-area="JobSeeker" asp-controller="Account" asp-action="ForgotPassword">Forgot Password?</a>
                <br />
                <a asp-area="JobSeeker" asp-controller="Account" asp-action="RecoverAccount">Recover Account</a>

            </div>

            <button type="submit" class="login-btn">Login</button>

            <!-- 🔹 New Staff Login Button -->
            <div class="alt-option">
                <a asp-area="JobSeeker" asp-controller="Account" asp-action="StaffLogin" class="alt-btn">Login as
                    Staff</a>
            </div>

            <p class="switch-text">
                Don’t have an account? <a href="#" id="switchToRegister">Register here</a>
            </p>
        </form>

        <!-- ✅ Register Form -->
        <form id="registerForm" asp-area="JobSeeker" asp-controller="Account" asp-action="Register" method="post"
            class="auth-form" onsubmit="return validateRegisterForm()">
            <!-- Full Name split into First Name & Last Name -->
            <div class="name-row">
                <div class="form-group">
                    <label for="firstName">First Name</label>
                    <input type="text" id="firstName" name="firstName" maxlength="30" placeholder="First Name"
                        required />
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" name="lastName" maxlength="30" placeholder="Last Name" required />
                </div>
            </div>

            <label for="regEmail">Email</label>
            <input type="email" id="regEmail" name="email" maxlength="190" placeholder="Enter your email" required>

            <label for="regPassword">Password</label>
            <div class="password-wrapper">
                <input type="password" id="regPassword" name="password" placeholder="Enter your password" required
                    maxlength="20" />
                <span class="toggle-password"><i class="bi bi-eye"></i></span>
            </div>

            <label for="confirmPassword">Confirm Password</label>
            <div class="password-wrapper">
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Re-enter your password"
                    required maxlength="20" />
                <span class="toggle-password"><i class="bi bi-eye"></i></span>
            </div>

            <button type="submit" class="login-btn">Register</button>

<!-- 🔹 New Recruiter Registration Button -->
            <div class="alt-option">
                <a asp-area="Recruiter" asp-controller="Account" asp-action="Register" class="alt-btn">
                    Register as Recruiter
                </a>
            </div>

            <p class="switch-text">
                Already have an account? <a href="#" id="switchToLogin">Login here</a>
            </p>
        </form>
    </div>
</div>

<!-- ✅ Script section -->
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // ===============================
            // 🔹 LOGIN / REGISTER TAB SWITCH
            // ===============================
            const loginTab = document.getElementById("loginTab");
            const registerTab = document.getElementById("registerTab");
            const loginForm = document.getElementById("loginForm");
            const registerForm = document.getElementById("registerForm");
            const switchToRegister = document.getElementById("switchToRegister");
            const switchToLogin = document.getElementById("switchToLogin");

            function showLogin() {
                loginTab.classList.add("active");
                registerTab.classList.remove("active");
                loginForm.classList.add("active");
                registerForm.classList.remove("active");
            }

            function showRegister() {
                registerTab.classList.add("active");
                loginTab.classList.remove("active");
                registerForm.classList.add("active");
                loginForm.classList.remove("active");
            }

            loginTab.addEventListener("click", showLogin);
            registerTab.addEventListener("click", showRegister);
            switchToRegister?.addEventListener("click", e => { e.preventDefault(); showRegister(); });
            switchToLogin?.addEventListener("click", e => { e.preventDefault(); showLogin(); });


            // ===============================
            // 🔹 AUTO SWITCH TAB VIA URL PARAM
            // ===============================
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('tab') === 'register') {
                showRegister();
            }

            // ===============================
            // 🔹 SWEETALERT MESSAGES
            // ===============================
            const message = '@TempData["Message"]';
            if (message && message.length > 0) {
                let alertType = 'info';
                let alertTitle = 'Notification';

                if (message.toLowerCase().includes("verify your email")) {
                    alertType = 'warning';
                    alertTitle = 'Email Verification Required';
                }
                else if (message.toLowerCase().includes("verified successfully")) {
                    alertType = 'success';
                    alertTitle = 'Account Verified';
                }
                else if (message.toLowerCase().includes("already registered")) {
                    alertType = 'error';
                    alertTitle = 'Email Already Registered';
                }
                else if (message.toLowerCase().includes("passwords do not match")) {
                    alertType = 'error';
                    alertTitle = 'Password Mismatch';
                }

                Swal.fire({
                    icon: alertType,
                    title: alertTitle,
                    text: message,
                    confirmButtonText: 'OK',
                    confirmButtonColor:
                        alertType === 'success' ? '#28a745' :
                            alertType === 'warning' ? '#f0ad4e' : '#dc3545'
                }).then(() => {
                    if (message.toLowerCase().includes("verify your email")) {
                        showLogin();
                    }
                });
            }

            // ===============================
            // 🔹 2FA CODE PROMPT (Google Authenticator)
            // ===============================
            const require2FA = '@TempData["Require2FA"]';
            const pendingEmail = '@TempData["PendingEmail"]';
            const pendingPassword = '@TempData["PendingPassword"]';

            if (require2FA === "true") {
                Swal.fire({
                    title: "Two-Factor Authentication",
                    text: "Please enter your 6-digit code from Google Authenticator",
                    input: "text",
                    inputPlaceholder: "Enter code",
                    showCancelButton: false,
                    confirmButtonText: "Verify",
                    confirmButtonColor: "#28a745",
                    preConfirm: (code) => {
                        if (!code) {
                            Swal.showValidationMessage("Please enter your 2FA code");
                            return false;
                        }

                        // ✅ Submit with stored email & password
                        const form = document.createElement("form");
                        form.method = "POST";
                        form.action = "/JobSeeker/Account/Login";
                        form.innerHTML = `
                                                                                            <input type="hidden" name="email" value="${pendingEmail}">
                                                                                            <input type="hidden" name="password" value="${pendingPassword}">
                                                                                            <input type="hidden" name="twoFACode" value="${code}">
                                                                                        `;
                        document.body.appendChild(form);
                        form.submit();
                    }
                });
            }
        });
        function validateRegisterForm() {
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("regEmail").value.trim();
            const password = document.getElementById("regPassword").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            if (name.length > 60) {
                Swal.fire("Invalid Input", "Full name cannot exceed 60 characters.", "error");
                return false;
            }
            if (password.length < 6 || password.length > 20) {
                Swal.fire("Invalid Input", "Password must be between 6 and 20 characters.", "error");
                return false;
            }

            const emailPattern = /^[^\s@@]+@@[^\s@@]+\.[a-zA-Z]{2,}$/;
            if (!emailPattern.test(email)) {
                Swal.fire("Invalid Input", "Please enter a valid email address.", "error");
                return false;
            }
            if (password !== confirmPassword) {
                Swal.fire("Password Mismatch", "Passwords do not match.", "error");
                return false;
            }
            return true;
        }
        // Show/hide password toggle
        document.querySelectorAll(".toggle-password").forEach(btn => {
            btn.addEventListener("click", () => {
                const input = btn.previousElementSibling;
                const icon = btn.querySelector("i");
                if (input.type === "password") {
                    input.type = "text";
                    icon.classList.remove("bi-eye");
                    icon.classList.add("bi-eye-slash");
                } else {
                    input.type = "password";
                    icon.classList.remove("bi-eye-slash");
                    icon.classList.add("bi-eye");
                }
            });
        });



    </script>
}