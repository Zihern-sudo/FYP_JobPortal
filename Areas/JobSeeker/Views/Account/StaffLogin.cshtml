@{
    ViewData["Title"] = "Staff Login";
}

<div class="auth-container">
    <h1>Staff Login</h1>

    <div class="form-wrapper">
        <!-- âœ… Staff Login Form -->
        <form id="staffLoginForm" asp-area="JobSeeker" asp-controller="Account" asp-action="StaffLogin" method="post"
            class="auth-form active">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="Enter your staff email" value="@ViewBag.Email" required>

            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" required>

            <div class="forgot-password">
                <a asp-area="JobSeeker" asp-controller="Account" asp-action="ForgotPassword">Forgot Password?</a>
            </div>

            <button type="submit" class="login-btn">Login</button>

            <p class="switch-text">
                Back to <a href="/JobSeeker/Account/Login">User Login</a>
            </p>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // ===============================
            // ðŸ”¹ SWEETALERT MESSAGES
            // ===============================
            const message = '@TempData["Message"]';
            if (message && message.length > 0) {
                let alertType = 'info';
                let alertTitle = 'Notification';

                if (message.toLowerCase().includes("verify your email")) {
                    alertType = 'warning';
                    alertTitle = 'Email Verification Required';
                }
                else if (message.toLowerCase().includes("verified successfully")) {
                    alertType = 'success';
                    alertTitle = 'Account Verified';
                }
                else if (message.toLowerCase().includes("already registered")) {
                    alertType = 'error';
                    alertTitle = 'Email Already Registered';
                }
                else if (message.toLowerCase().includes("passwords do not match")) {
                    alertType = 'error';
                    alertTitle = 'Password Mismatch';
                }
                else if (message.toLowerCase().includes("invalid staff login")) {
                    alertType = 'error';
                    alertTitle = 'Invalid Staff Login';
                }

                Swal.fire({
                    icon: alertType,
                    title: alertTitle,
                    text: message,
                    confirmButtonText: 'OK',
                    confirmButtonColor:
                        alertType === 'success' ? '#28a745' :
                            alertType === 'warning' ? '#f0ad4e' : '#dc3545'
                });
            }

            // ===============================
            // ðŸ”¹ 2FA CODE PROMPT (Google Authenticator)
            // ===============================
            const require2FA = '@TempData["Require2FA"]';
            const pendingEmail = '@TempData["PendingEmail"]';
            const pendingPassword = '@TempData["PendingPassword"]';

            if (require2FA === "true") {
                Swal.fire({
                    title: "Two-Factor Authentication",
                    text: "Please enter your 6-digit code from Google Authenticator",
                    input: "text",
                    inputPlaceholder: "Enter code",
                    showCancelButton: false,
                    confirmButtonText: "Verify",
                    confirmButtonColor: "#28a745",
                    preConfirm: (code) => {
                        if (!code) {
                            Swal.showValidationMessage("Please enter your 2FA code");
                            return false;
                        }

                        // âœ… Submit with stored email & password
                        const form = document.createElement("form");
                        form.method = "POST";
                        form.action = "/JobSeeker/Account/StaffLogin";
                        form.innerHTML = `
                            <input type="hidden" name="email" value="${pendingEmail}">
                            <input type="hidden" name="password" value="${pendingPassword}">
                            <input type="hidden" name="twoFACode" value="${code}">
                        `;
                        document.body.appendChild(form);
                        form.submit();
                    }
                });
            }
        });
    </script>
}
