@model JobPortal.Areas.Shared.Models.job_listing
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@using Microsoft.AspNetCore.Http

@{
    Layout = "_LayoutDashboard";
    ViewData["Title"] = "Job Details";
}

<section class="job-details">
    <h1>@Model.job_title</h1>

    <div class="job-meta">
        @*
       // üñºÔ∏è Company Logo (if available) 
        @if (!string.IsNullOrEmpty(Model.company.company_photo))
        {
            <img src="~/uploads/@Model.company.company_photo" 
                 alt="Company Logo" 
                 class="company-logo mb-3" 
                 style="width:120px; height:auto;" />
        } 
*@

        <p><strong>Company:</strong> @Model.company.company_name</p>
        <p><strong>Location:</strong> @Model.company.company_location</p>
        <p><strong>Industry:</strong> @Model.company.company_industry</p>
        <p><strong>Status:</strong> @Model.job_status</p>
        <p><strong>Posted On:</strong> @Model.date_posted.ToString("yyyy-MM-dd")</p>
    </div>

    <hr />

    <div class="row mt-4">
        <!-- Left column: Job description -->
        <div class="col-md-8">
            <h4>Description</h4>
            <p>@Model.job_description</p>
        </div>

        <!-- Right column: Quick details box -->
        <div class="col-md-4">
            <div class="card shadow-sm p-3 border rounded-3">
                <h5 class="mb-3">Job Details</h5>

                <p><strong>Requirements:</strong><br>@Model.job_requirements</p>
                <hr>

                <div class="tags mb-3">
                    <span class="tag tag-blue">@Model.job_type</span>
                    <span class="tag tag-orange">@Model.work_mode</span>
                    <span class="tag tag-green">
                        RM @(Model.salary_min?.ToString("N0") ?? "0") - RM @(Model.salary_max?.ToString("N0") ?? "0")
                    </span>
                </div>
            </div>
        </div>

    </div>

    <div class="d-flex justify-content-between align-items-center mt-4">
        <a href="@Url.Action("JobListings")" class="btn btn-secondary">‚Üê Back to Listing</a>

        <div class="d-flex align-items-center gap-2">
            <!-- Favourite star button (to the left of Apply) -->
            <button type="button" class="btn btn-sm p-1 favourite-toggle" data-job-id="@Model.job_listing_id"
                style="font-size:1.5rem; line-height:1;">
                @(ViewBag.IsFavourite ? "‚≠ê" : "‚òÜ")
            </button>

            @if (ViewBag.HasApplied)
            {
                <button class="btn btn-secondary" disabled>Applied</button>
            }
            else
            {
                <a asp-area="JobSeeker" asp-controller="Dashboard" asp-action="Apply" asp-route-id="@Model.job_listing_id"
                    class="btn btn-success">Apply Now</a>
            }
        </div>
    </div>


</section>
@section Scripts {
    <script>
        document.querySelectorAll('.favourite-toggle').forEach(btn => {
            btn.addEventListener('click', async function () {
                const jobId = this.dataset.jobId;
                const response = await fetch('@Url.Action("ToggleFavourite", "Dashboard")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': '@Antiforgery.GetAndStoreTokens(ViewContext.HttpContext).RequestToken'
                    },
                    body: JSON.stringify({ jobId })
                });

                const result = await response.json();

                if (result.success) {
                    this.textContent = result.isFavourite ? '‚≠ê' : '‚òÜ';
                }
            });
        });
    </script>
}