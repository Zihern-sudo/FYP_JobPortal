@{
    Layout = "_LayoutDashboard";
    ViewData["Title"] = "Resume Builder";
}
<link rel="stylesheet" href="~/css/dashboard.css" />

<div class="resume-builder-container">
    <h1>Resume Builder</h1>

    <form id="resumeForm" method="post" action="/JobSeeker/Dashboard/SaveResume" enctype="multipart/form-data">
        <h3>Personal Information</h3>

        <label for="template">Choose Resume Template</label>
        <select id="template" name="template" required>
            <option value="classic">Classic</option>
            <option value="modern">Modern</option>
        </select>

        <!-- Profile Picture Upload -->
        <label>Profile Picture</label>
        <input type="file" id="profilePic" name="profilePic" accept="image/*" />
        <div id="profilePreview" style="margin-top:10px;">
            <img id="previewImg" src="#" alt="Preview"
                style="display:none; width:120px; height:120px; border-radius:50%; object-fit:cover;" />
        </div>

        <label>Full Name</label>
        <input type="text" id="fullName" name="fullName" value="@Model.FullName" placeholder="John Doe" required />

        <label>Email</label>
        <input type="email" id="email" name="email" value="@Model.Email" placeholder="john@example.com" required />

        <label>Phone</label>
        <input type="text" id="phone" name="phone" value="@Model.Phone" placeholder="+60 12-345 6789" />

        <label>Address</label>
        <input type="text" id="address" name="address" value="@Model.Address" placeholder="Kuala Lumpur, Malaysia" />

        <h3>Professional Summary</h3>
        <textarea id="summary" name="summary" rows="4"
            placeholder="Briefly describe your background...">@Model.Summary</textarea>


        <h3>Education</h3>
        <label>School / University</label>
        <input type="text" id="school" name="school" placeholder="University of XYZ" />

        <label>Degree</label>
        <input type="text" id="degree" name="degree" placeholder="Bachelor of Science in Computer Science" />

        <label>Year</label>
        <input type="text" id="eduYear" name="eduYear" placeholder="2020 - 2024" />

        <h3>Work Experience</h3>
        <div id="experienceContainer">
            <div class="experience-entry">
                <label>Company</label>
                <input type="text" id="company" name="company" placeholder="ABC Corp" />

                <label>Position</label>
                <input type="text" id="position" name="position" placeholder="Software Intern" />

                <label>Duration</label>
                <input type="text" id="duration" name="duration" placeholder="2 years, 6 months" />

                <label>Responsibilities / Achievements</label>
                <textarea id="achievements" name="achievements" placeholder="Describe your contributions..."
                    rows="3"></textarea>
            </div>
        </div>

        <!-- Add new experience button -->
        <button type="button" id="addExperienceBtn" style="margin-top:10px;">+ Add Another Experience</button>



        <h3>Skills & Certifications</h3>
        <input type="text" id="skills" name="skills" value="@Model.Skills" placeholder="C#, ASP.NET, SQL" />
        <input type="text" id="certifications" name="certifications" value="@Model.Certifications"
            placeholder="Microsoft Certified: Azure Fundamentals" />


        <button type="button" id="previewBtn">Preview Resume</button>
        <button type="submit" id="downloadServerPDF" style="margin-left:10px;">Generate PDF</button>

        <input type="hidden" id="education" name="education" />
        <input type="hidden" id="experience" name="experience" />
    </form>

    <div id="resumePreview" style="border:1px solid #ccc; padding:20px; margin-top:20px;">
        <h2>Resume Preview</h2>
        <div id="resumeContent"></div>
    </div>
</div>

<script>
    // ðŸ–¼ï¸ Image preview
    document.getElementById("profilePic").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const img = document.getElementById("previewImg");
                img.src = event.target.result;
                img.style.display = "block";
            };
            reader.readAsDataURL(file);
        }
    });

    // ðŸ§¾ Preview Resume Content
    document.getElementById("previewBtn").addEventListener("click", function () {
        const name = document.getElementById("fullName").value;
        const email = document.getElementById("email").value;
        const phone = document.getElementById("phone").value;
        const address = document.getElementById("address").value;
        const summary = document.getElementById("summary").value;
        const school = document.getElementById("school").value;
        const degree = document.getElementById("degree").value;
        const eduYear = document.getElementById("eduYear").value;
        const skills = document.getElementById("skills").value;
        const certifications = document.getElementById("certifications").value;
        const profileImg = document.getElementById("previewImg").src;

        // Gather all experience sections
        const experiences = [];
        document.querySelectorAll(".experience-entry").forEach(entry => {
            const company = entry.querySelector('[name="company"]').value.trim();
            const position = entry.querySelector('[name="position"]').value.trim();
            const duration = entry.querySelector('[name="duration"]').value.trim();
            const achievements = entry.querySelector('[name="achievements"]').value.trim();

            if (company || position || duration || achievements) {
                experiences.push(`${position} at ${company} (${duration}) â€” ${achievements}`);
            }
        });

        // Create preview content dynamically (hide empty sections)
        let content = `
            <div style="display:flex; align-items:center; gap:20px;">
                ${profileImg && profileImg !== "#" ? `<img src="${profileImg}" style="width:100px; height:100px; border-radius:50%; object-fit:cover;">` : ""}
                <div>
                    <h3>${name}</h3>
                    ${email ? `<p>${email}</p>` : ""}
                    ${phone ? `<p>${phone}</p>` : ""}
                    ${address ? `<p>${address}</p>` : ""}
                </div>
            </div>
            <hr/>
        `;

        if (summary) content += `<p><strong>Summary:</strong> ${summary}</p>`;
        if (degree || school || eduYear) content += `<p><strong>Education:</strong> ${degree} at ${school} (${eduYear})</p>`;
        if (experiences.length > 0) content += `<p><strong>Experience:</strong><br> ${experiences.join("<br>")}</p>`;
        if (skills) content += `<p><strong>Skills:</strong> ${skills}</p>`;
        if (certifications) content += `<p><strong>Certifications:</strong> ${certifications}</p>`;

        document.getElementById("resumeContent").innerHTML = content;
    });

    // âž• Add new experience entry
    document.getElementById("addExperienceBtn").addEventListener("click", function () {
        const container = document.getElementById("experienceContainer");

        const newEntry = document.createElement("div");
        newEntry.classList.add("experience-entry");
        newEntry.style.marginTop = "15px";
        newEntry.innerHTML = `
        <hr style="margin:10px 0;">
        <button type="button" class="removeExperienceBtn" style="margin-bottom:10px;">Remove</button>
        <label>Company</label>
        <input type="text" name="company" placeholder="Company name" />

        <label>Position</label>
        <input type="text" name="position" placeholder="Job Title" />

        <label>Duration</label>
        <input type="text" name="duration" placeholder="1 year, 3 months" />

        <label>Responsibilities / Achievements</label>
        <textarea name="achievements" placeholder="Describe your contributions..." rows="3"></textarea>
    `;
        container.appendChild(newEntry);

        // âœ… Attach remove event properly
        newEntry.querySelector(".removeExperienceBtn").addEventListener("click", function () {
            container.removeChild(newEntry);
        });
    }); // âœ… <- this closing brace was missing before


    // ðŸ§© Combine for submission (for PDF generation)
    document.getElementById("resumeForm").addEventListener("submit", function () {
        const school = document.getElementById("school").value.trim();
        const degree = document.getElementById("degree").value.trim();
        const eduYear = document.getElementById("eduYear").value.trim();

        // ðŸŽ“ Education
        if (degree || school || eduYear) {
            document.getElementById("education").value = `${degree} at ${school} (${eduYear})`;
        } else {
            document.getElementById("education").value = "";
        }

        // ðŸ’¼ Collect all experiences
        const experiences = [];
        document.querySelectorAll(".experience-entry").forEach(entry => {
            const company = entry.querySelector('[name="company"]').value.trim();
            const position = entry.querySelector('[name="position"]').value.trim();
            const duration = entry.querySelector('[name="duration"]').value.trim();
            const achievements = entry.querySelector('[name="achievements"]').value.trim();

            if (company || position || duration || achievements) {
                let durationText = duration;
                if (/less than|<\s*1\s*year/i.test(duration)) {
                    durationText = "<1 year";
                } else if (/^\d+\s*(months?|mo)$/i.test(duration)) {
                    durationText = "Less than 1 year";
                }
                experiences.push(`${position} at ${company} (${durationText}) â€” ${achievements}`);
            }
        });

        // Combine all experiences into one hidden field
        document.getElementById("experience").value = experiences.join("\n");
    });
</script>