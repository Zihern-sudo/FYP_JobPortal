@model JobPortal.Areas.JobSeeker.Models.MyApplicationsViewModel

@{
    Layout = "_LayoutDashboard";
    ViewData["Title"] = "My Applications";
}

<link rel="stylesheet" href="~/css/dashboard.css" />

<section class="my-applications-section">
    <h1 class="page-title">My Applications</h1>

    <!-- Dashboard Summary Cards -->
    <section class="summary mb-4 d-flex gap-3">
        <div class="summary-card">
            <h3>Total Applications</h3>
            <p class="summary-number">@Model.Dashboard.TotalApplications</p>
        </div>
        <div class="summary-card">
            <h3>Applications in Review</h3>
            <p class="summary-number">@Model.Dashboard.ApplicationsInReview</p>
        </div>
        <div class="summary-card">
            <h3>Interviews Scheduled</h3>
            <p class="summary-number">@Model.Dashboard.InterviewsScheduled</p>
        </div>
    </section>

    <!-- Recent Activity -->
    <section class="recent-activity mb-4">
        <h2>Recent Activity</h2>
        <ul>
            @foreach (var activity in Model.Dashboard.RecentActivities)
            {
                <li>@activity.Message <span>@activity.Date.ToString("yyyy-MM-dd HH:mm")</span></li>
            }
        </ul>
    </section>

    <!-- Recent Notifications -->
    <section class="recent-notifications mb-4">
        <h2>Recent Notifications</h2>
        <ul>
            @foreach (var notif in Model.Dashboard.RecentNotifications)
            {
                <li>@notif.Message <span>@notif.Date.ToString("yyyy-MM-dd HH:mm")</span></li>
            }
        </ul>
    </section>

<form method="get" asp-controller="Dashboard" asp-action="Applications"
      class="d-flex align-items-center gap-3 mb-3">

    <!-- Filter by Status -->
    <div>
        <label for="status" class="me-1 fw-semibold">Status:</label>
        <select id="status" name="status" class="form-select w-auto">
            <option value="">All</option>
            <option value="Submitted" selected="@(ViewBag.SelectedStatus == "Submitted" ? "selected" : "")">Submitted</option>
            <option value="AI-Screened" selected="@(ViewBag.SelectedStatus == "AI-Screened" ? "selected" : "")">AI-Screened</option>
            <option value="Shortlisted" seleceted="@(ViewBag.SelectedStatus == "Shortlisted" ? "selected" : "")">Shortlisted</option>
            <option value="Interview" selected="@(ViewBag.SelectedStatus == "Interview" ? "selected" : "")">Interview</option>
            <option value="Offer" selected="@(ViewBag.SelectedStatus == "Offer" ? "selected" : "")">Offer</option>
            <option value="Hired" selected="@(ViewBag.SelectedStatus == "Hired" ? "selected" : "")">Hired</option>
            <option value="Rejected" selected="@(ViewBag.SelectedStatus == "Rejected" ? "selected" : "")">Rejected</option>
        </select>
    </div>

    <!-- Sort -->
    <div>
        <label for="sortBy" class="me-1 fw-semibold">Sort:</label>
        <select id="sortBy" name="sortBy" class="form-select w-auto">
            <option value="">Newest First</option>
            <option value="date_asc" selected="@(ViewBag.SortBy == "date_asc" ? "selected" : "")">Oldest First</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary btn-sm">Apply</button>
</form>



    <!-- Applications Table -->
    <div class="applications-table-container mb-4">
        <table class="applications-table">
            <thead>
                <tr>
                    <th>Job Title</th>
                    <th>Company</th>
                    <th>Location</th>
                    <th>Industry</th>
                    <th>Salary Range</th>
                    <th>Last Updated</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model.Applications.Any())
                {
                    <tr>
                        <td colspan="7" class="text-center">You haven’t applied to any jobs yet.</td>
                    </tr>
                }
                else
                {
                    foreach (var app in Model.Applications)
                    {
                        var job = app.job_listing;
                        var company = job?.company;

                        <tr>
                            <td>
                                @job?.job_title
                                @if (app.application_status == "Offer")
                                {
                                    <form asp-controller="Dashboard" asp-action="AcceptOffer" method="post" style="display:inline;">
                                        <input type="hidden" name="applicationId" value="@app.application_id" />
                                        <button type="submit" class="btn btn-success btn-sm">Accept Offer</button>
                                    </form>
                                }
                            </td>
                            <td>@company?.company_name</td>
                            <td>@company?.company_location</td>
                            <td>@company?.company_industry</td>
                            <td>
                                @if (job?.salary_min != null && job?.salary_max != null)
                                {
                                    @:RM @job.salary_min - RM @job.salary_max
                                }
                                else
                                {
                                    @:Not specified
                                }
                            </td>
                            <td>@app.date_updated.ToString("yyyy-MM-dd HH:mm")</td>
                            <td>
                                <span class="status status-@app.application_status.ToLower().Replace(" ", "")">
                                    @app.application_status
                                </span>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

<!-- Pagination -->
<div class="pagination">
    @if (Model.TotalPages > 1)
    {
        <button disabled="@(Model.CurrentPage == 1)"
            onclick="location.href='@Url.Action("Applications", new { 
                page = Model.CurrentPage - 1, 
                status = Model.SelectedStatus, 
                sortBy = Model.SortBy 
            })'">
            ⬅ Previous
        </button>

        <span>Page @Model.CurrentPage of @Model.TotalPages</span>

        <button disabled="@(Model.CurrentPage == Model.TotalPages)"
            onclick="location.href='@Url.Action("Applications", new { 
                page = Model.CurrentPage + 1, 
                status = Model.SelectedStatus, 
                sortBy = Model.SortBy 
            })'">
            Next ➡
        </button>
    }
    else
    {
        <span>Showing all @Model.Applications.Count() applications</span>
    }
</div>

</section>