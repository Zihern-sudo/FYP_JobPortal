@* File: Areas/Recruiter/Views/Jobs/Preview.cshtml *@
@{
  var job = (JobPortal.Areas.Recruiter.Models.JobItemVM)ViewBag.Job;
  var req = (JobPortal.Areas.Recruiter.Models.JobRequirementVM)ViewBag.Req;
  string? desc = ViewBag.Desc as string;
  var company = ViewBag.Company as string;

  // NEW: extra fields
  string? jobCategory = ViewBag.JobCategory as string;
  string? workMode = ViewBag.WorkMode as string;

  // Pull value types from ViewBag safely
  decimal? smin = ViewBag.SalaryMin != null ? (decimal)ViewBag.SalaryMin : (decimal?)null;
  decimal? smax = ViewBag.SalaryMax != null ? (decimal)ViewBag.SalaryMax : (decimal?)null;
  DateTime? expiry = ViewBag.ExpiryDate != null ? (DateTime)ViewBag.ExpiryDate : (DateTime?)null;

  // Inline helper to render salary text
  string? SalaryText()
  {
    if (smin.HasValue && smax.HasValue) return $"{smin.Value:N2} â€“ {smax.Value:N2}";
    if (smin.HasValue) return $"From {smin.Value:N2}";
    if (smax.HasValue) return $"Up to {smax.Value:N2}";
    return null;
  }

  // small helpers: split bullets on newline or comma
  string[] Bullets(string? text)
  => string.IsNullOrWhiteSpace(text)
  ? Array.Empty<string>()
  : text!.Replace("\r", "")
  .Split(new[] { '\n', ',' }, StringSplitOptions.RemoveEmptyEntries)
  .Select(x => x.Trim()).Where(x => x.Length > 0).ToArray();
}

<a asp-area="Recruiter" asp-controller="Jobs" asp-action="Index" class="d-inline-block text-decoration-none mb-3">
  &leftarrow; Back to Jobs
</a>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="d-flex align-items-start justify-content-between">
      <div>
        <h4 class="mb-1">@job.Title</h4>

        <!-- Meta row: keep everything inline and evenly spaced -->
        <div class="text-muted">
          <span class="me-3">
            <i class="bi bi-geo-alt"></i>
            @(!string.IsNullOrWhiteSpace(job.Location) ? job.Location : "Location not specified")
          </span>
          <span class="me-3">
            <i class="bi bi-building"></i>
            @(string.IsNullOrWhiteSpace(company) ? "Company" : company)
          </span>
          <span class="me-3">
            <i class="bi bi-diagram-3"></i>
            @(string.IsNullOrWhiteSpace(jobCategory) ? "Category not specified" : jobCategory)
          </span>
          <span class="me-3">
            <i class="bi bi-laptop"></i>
            @(string.IsNullOrWhiteSpace(workMode) ? "Work mode not specified" : workMode)
          </span>

          @* Salary (inline) *@
          @if (!string.IsNullOrWhiteSpace(SalaryText()))
          {
            <span class="me-3">
              <i class="bi bi-cash-coin"></i>
              <strong>Salary:</strong> @SalaryText()
            </span>
          }

          @* Expiry date (inline) *@
          @if (expiry.HasValue)
          {
            <span class="me-3">
              <i class="bi bi-calendar-event"></i>
              <strong>Application closes:</strong> @expiry.Value.ToString("yyyy-MM-dd")
            </span>
          }

          <span>
            <i class="bi bi-clock-history"></i>
            <strong>Posted:</strong> @job.CreatedAt
          </span>
        </div>
      </div>

      <span
        class="badge rounded-pill bg-@(job.Status == JobPortal.Areas.Recruiter.Models.JobStatus.Open ? "success" : (job.Status == JobPortal.Areas.Recruiter.Models.JobStatus.Paused ? "warning text-dark" : "secondary"))"
        style="font-size:.9rem; padding:.5rem .75rem;">
        @job.Status
      </span>
    </div>

    <hr />

    <!-- Description FIRST -->
    <section class="mb-4">
      <h6 class="text-uppercase text-muted mb-2">Job Description</h6>
      @if (string.IsNullOrWhiteSpace(desc))
      {
        <p class="text-muted fst-italic">No description provided.</p>
      }
      else
      {
        <p style="white-space:pre-line">@desc</p>
      }
    </section>

    <!-- Requirements -->
    <section>
      <h6 class="text-uppercase text-muted mb-2">Requirements</h6>

      <div class="mb-2">
        <strong>Must-haves:</strong>
        @if (Bullets(req.MustHaves).Length == 0)
        {
          <div class="text-muted">Not specified</div>
        }
        else
        {
          <ul class="mb-0">
            @foreach (var b in Bullets(req.MustHaves))
            {
              <li>@b</li>
            }
          </ul>
        }
      </div>

      @if (!string.IsNullOrWhiteSpace(req.NiceToHaves))
      {
        <div class="mt-3">
          <strong>Nice-to-haves:</strong>
          <ul class="mb-0">
            @foreach (var b in Bullets(req.NiceToHaves))
            {
              <li>@b</li>
            }
          </ul>
        </div>
      }
    </section>
  </div>
</div>