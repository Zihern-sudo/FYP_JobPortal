@* ==========================
   File: Areas/Admin/Views/Users/Index.cshtml
   ========================== *@
@model JobPortal.Areas.Admin.Models.RecruitersIndexViewModel
@{
    ViewData["Title"] = "Recruiters";
    string Active(string s) => string.Equals(Model.Status, s, StringComparison.OrdinalIgnoreCase) ? "active" : "";
    string Chip(string s) => s switch
    {
        "Active" => "badge text-bg-success",
        "Suspended" => "badge text-bg-danger",
        "Inactive" => "badge text-bg-secondary",
        _ => "badge text-bg-light"
    };
}

<div class="card shadow-sm mb-3">
    <div class="card-body">
        <form method="get" class="row g-2 align-items-end">
            <div class="col-12">
                <div class="btn-group mb-2">
                    <a class="btn btn-outline-secondary @Active("All")" asp-action="Index" asp-route-status="All"
                        asp-route-q="@Model.Query" asp-route-from="@((string?)ViewBag.From)"
                        asp-route-to="@((string?)ViewBag.To)">All (@Model.AllCount)</a>

                    <a class="btn btn-outline-success @Active("Active")" asp-action="Index" asp-route-status="Active"
                        asp-route-q="@Model.Query" asp-route-from="@((string?)ViewBag.From)"
                        asp-route-to="@((string?)ViewBag.To)">Active (@Model.ActiveCount)</a>

                    <a class="btn btn-outline-warning @Active("Pending")" asp-action="Index" asp-route-status="Pending"
                        asp-route-q="@Model.Query" asp-route-from="@((string?)ViewBag.From)"
                        asp-route-to="@((string?)ViewBag.To)">Pending (@Model.PendingCount)</a>

                    <a class="btn btn-outline-danger @Active("Suspended")" asp-action="Index"
                        asp-route-status="Suspended" asp-route-q="@Model.Query"
                        asp-route-from="@((string?)ViewBag.From)" asp-route-to="@((string?)ViewBag.To)">Suspended
                        (@Model.SuspendedCount)</a>
                </div>
            </div>

            <div class="col-auto">
                <input class="form-control" type="search" name="q" value="@Model.Query"
                    placeholder="Search name/email/company">
                <input type="hidden" name="status" value="@Model.Status" />
            </div>

            <div class="col-auto">
                <label class="form-label mb-0 small">From</label>
                <input class="form-control" type="date" name="from" value="@((string?)ViewBag.From)">
            </div>

            <div class="col-auto">
                <label class="form-label mb-0 small">To</label>
                <input class="form-control" type="date" name="to" value="@((string?)ViewBag.To)">
            </div>

            <div class="col-auto">
                <button class="btn btn-primary" type="submit">Apply</button>
            </div>

            <div class="col-auto ms-auto">
                <a class="btn btn-outline-secondary" asp-action="ExportCsv" asp-route-status="@Model.Status"
                    asp-route-q="@Model.Query" asp-route-from="@ViewBag.From" asp-route-to="@ViewBag.To">
                    Export CSV
                </a>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <form method="post" asp-action="Bulk">
        @Html.AntiForgeryToken()
        <input type="hidden" name="status" value="@Model.Status" />
        <input type="hidden" name="q" value="@Model.Query" />
        <input type="hidden" name="from" value="@ViewBag.From" />
        <input type="hidden" name="to" value="@ViewBag.To" />
        <input type="hidden" name="page" value="@Model.Items.Page" />

        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table align-middle mb-0">
                    <thead>
                        <tr>
                            <th style="width:36px"><input type="checkbox" id="chkAll" /></th>
                            <th style="width:80px">ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Company</th>
                            <th style="width:120px">User Status</th>
                            <th style="width:120px">Company</th>
                            <th style="width:160px">Created</th>
                            <th style="width:140px" class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!Model.Items.Items.Any())
                        {
                            <tr>
                                <td colspan="9" class="text-center text-muted py-4">No recruiters found</td>
                            </tr>
                        }
                        else
                        {
                            foreach (var r in Model.Items.Items)
                            {
                                var cchip = r.CompanyStatus switch
                                {
                                    "Active" => "badge text-bg-success",
                                    "Pending" => "badge text-bg-warning",
                                    "Suspended" => "badge text-bg-danger",
                                    null or "" => "badge text-bg-secondary",
                                    _ => "badge text-bg-secondary"
                                };
                                <tr>
                                    <td><input type="checkbox" name="ids" value="@r.Id" class="rowChk" /></td>
                                    <td>@r.Id</td>
                                    <td>@r.Name</td>
                                    <td>@r.Email</td>
                                    <td>@(string.IsNullOrWhiteSpace(r.Company) ? "-" : r.Company)</td>
                                    <td><span class="@Chip(r.Status)">@r.Status</span></td>
                                    <td><span class="@cchip">@((string.IsNullOrWhiteSpace(r.CompanyStatus) ? "—" :
                                                                                r.CompanyStatus))</span></td>
                                    <td>@r.CreatedAt.ToString("g")</td>
                                    <td class="text-end">
                                        <div class="btn-group">
                                            <a class="btn btn-sm btn-outline-primary" asp-action="Preview"
                                                asp-route-id="@r.Id">Open</a>
                                            <button type="button"
                                                class="btn btn-sm btn-outline-primary dropdown-toggle dropdown-toggle-split"
                                                data-bs-toggle="dropdown" aria-expanded="false">
                                                <span class="visually-hidden">Toggle Dropdown</span>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li>
                                                    <form method="post" asp-action="Approve" class="px-3 py-1">
                                                        @Html.AntiForgeryToken()
                                                        <input type="hidden" name="id" value="@r.Id" />
                                                        <button class="dropdown-item" type="submit">Approve (Activate)</button>
                                                    </form>
                                                </li>
                                                <li>
                                                    <form method="post" asp-action="Suspend" class="px-3 py-1">
                                                        @Html.AntiForgeryToken()
                                                        <input type="hidden" name="id" value="@r.Id" />
                                                        <button class="dropdown-item" type="submit">Suspend</button>
                                                    </form>
                                                </li>
                                                <li>
                                                    <form method="post" asp-action="Reactivate" class="px-3 py-1">
                                                        @Html.AntiForgeryToken()
                                                        <input type="hidden" name="id" value="@r.Id" />
                                                        <button class="dropdown-item" type="submit">Reactivate</button>
                                                    </form>
                                                </li>
                                                <li>
                                                    <hr class="dropdown-divider" />
                                                </li>
                                                <li>
                                                    <form method="post" asp-action="Reject" class="px-3 py-1">
                                                        @Html.AntiForgeryToken()
                                                        <input type="hidden" name="id" value="@r.Id" />
                                                        <button class="dropdown-item text-danger" type="submit">Reject
                                                            (Inactive)</button>
                                                    </form>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card-footer d-flex flex-wrap gap-2 align-items-center">
            <button type="submit" class="btn btn-success" name="actionType" value="Approve">Approve Selected</button>
            <button type="submit" class="btn btn-secondary" name="actionType" value="Reject">Reject Selected</button>
            <button type="submit" class="btn btn-outline-danger" name="actionType" value="Suspend">Suspend
                Selected</button>
            <button type="submit" class="btn btn-primary" name="actionType" value="Reactivate">Reactivate
                Selected</button>

            <div class="ms-auto text-muted small">
                Page @Model.Items.Page of @Model.Items.TotalPages • @Model.Items.TotalItems total
            </div>
        </div>
    </form>
</div>

<div class="mt-2 d-flex justify-content-end gap-2">
    @{
        var prev = Math.Max(1, Model.Items.Page - 1);
        var next = Math.Min(Model.Items.TotalPages, Model.Items.Page + 1);
    }
    <a class="btn btn-sm btn-outline-secondary @(Model.Items.Page == 1 ? "disabled" : "")" asp-action="Index"
        asp-route-status="@Model.Status" asp-route-q="@Model.Query" asp-route-from="@ViewBag.From"
        asp-route-to="@ViewBag.To" asp-route-page="@prev">Prev</a>

    <a class="btn btn-sm btn-outline-secondary @(Model.Items.Page == Model.Items.TotalPages ? "disabled" : "")"
        asp-action="Index" asp-route-status="@Model.Status" asp-route-q="@Model.Query" asp-route-from="@ViewBag.From"
        asp-route-to="@ViewBag.To" asp-route-page="@next">Next</a>
</div>

@section Scripts {
    <script>
        const all = document.getElementById('chkAll');
        if (all) {
            all.addEventListener('change', () =>
                document.querySelectorAll('.rowChk').forEach(cb => cb.checked = all.checked)
            );
        }
    </script>
}