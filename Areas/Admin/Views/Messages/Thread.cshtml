@model JobPortal.Areas.Admin.Models.ConversationThreadViewModel
@{
  ViewData["Title"] = $"Thread #{Model.ConversationId}";
  string Chip(string s) => s switch
  {
    "Active" => "badge text-bg-success",
    "Suspended" => "badge text-bg-danger",
    "Inactive" => "badge text-bg-secondary",
    _ => "badge text-bg-light"
  };
}

<div class="d-flex align-items-center gap-2 mb-3">
  <form method="post" asp-action="ToggleFlag" class="me-2">
    @Html.AntiForgeryToken()
    <input type="hidden" name="conversationId" value="@Model.ConversationId" />
    <button class="btn btn-warning btn-sm">Toggle Flag</button>
  </form>

  <form method="post" asp-action="MarkAllRead">
    @Html.AntiForgeryToken()
    <input type="hidden" name="conversationId" value="@Model.ConversationId" />
    <button class="btn btn-outline-secondary btn-sm">Mark all as read</button>
  </form>

  <div class="ms-auto d-flex gap-2">
    @if (Model.ParticipantA is not null)
    {
      <div class="btn-group">
        <button type="button" class="btn btn-sm btn-outline-primary">
          @Model.ParticipantA.Name <span class="ms-1 @Chip(Model.ParticipantA.Status)">@Model.ParticipantA.Status</span>
        </button>
        <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle dropdown-toggle-split"
          data-bs-toggle="dropdown"></button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <form method="post" asp-action="RestrictMessaging" class="px-3 py-1">
              @Html.AntiForgeryToken()
              <input type="hidden" name="conversationId" value="@Model.ConversationId" />
              <input type="hidden" name="userId" value="@Model.ParticipantA.UserId" />
              <button class="dropdown-item text-danger" type="submit">Suspend Messaging</button>
            </form>
          </li>
          <li>
            <form method="post" asp-action="AllowMessaging" class="px-3 py-1">
              @Html.AntiForgeryToken()
              <input type="hidden" name="conversationId" value="@Model.ConversationId" />
              <input type="hidden" name="userId" value="@Model.ParticipantA.UserId" />
              <button class="dropdown-item" type="submit">Allow Messaging</button>
            </form>
          </li>
        </ul>
      </div>
    }
    @if (Model.ParticipantB is not null)
    {
      <div class="btn-group">
        <button type="button" class="btn btn-sm btn-outline-primary">
          @Model.ParticipantB.Name <span class="ms-1 @Chip(Model.ParticipantB.Status)">@Model.ParticipantB.Status</span>
        </button>
        <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle dropdown-toggle-split"
          data-bs-toggle="dropdown"></button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <form method="post" asp-action="RestrictMessaging" class="px-3 py-1">
              @Html.AntiForgeryToken()
              <input type="hidden" name="conversationId" value="@Model.ConversationId" />
              <input type="hidden" name="userId" value="@Model.ParticipantB.UserId" />
              <button class="dropdown-item text-danger" type="submit">Suspend Messaging</button>
            </form>
          </li>
          <li>
            <form method="post" asp-action="AllowMessaging" class="px-3 py-1">
              @Html.AntiForgeryToken()
              <input type="hidden" name="conversationId" value="@Model.ConversationId" />
              <input type="hidden" name="userId" value="@Model.ParticipantB.UserId" />
              <button class="dropdown-item" type="submit">Allow Messaging</button>
            </form>
          </li>
        </ul>
      </div>
    }
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    @if (!Model.Messages.Any())
    {
      <div class="text-muted">No messages in this conversation.</div>
    }
    else
    {
      foreach (var m in Model.Messages)
      {
        <div class="mb-3">
          <div class="fw-semibold">@m.SenderName <span class="text-muted small">(@(m.SenderRole ?? "User"))</span></div>
          <div class="border rounded p-2">@m.Text</div>
          <div class="text-muted small mt-1">@m.Timestamp.ToString("g")</div>
        </div>
      }
    }
  </div>
</div>